{"version":3,"file":"page.js","sources":["../../src/js/page/utils.js","../../src/js/utils/storage.js","../../src/js/page/worker-messenger.js","../../src/js/page/gzip.js","../../src/js/page/svg-file.js","../../src/js/page/ui/pan-zoom.js","../../src/js/page/ui/svg-output.js","../../src/js/page/ui/code-output.js","../../src/js/page/prism.js","../../src/js/page/ui/output.js","../../src/js/page/ui/ripple.js","../../src/js/page/ui/floating-action-button.js","../../src/js/page/ui/spinner.js","../../src/js/page/ui/download-button.js","../../src/js/page/ui/copy-button.js","../../src/js/page/ui/bg-fill-button.js","../../src/js/page/ui/results.js","../../node_modules/nanoevents/index.js","../../src/js/page/ui/material-slider.js","../../src/js/page/ui/settings.js","../../src/js/page/ui/main-menu.js","../../src/js/page/ui/toasts.js","../../src/js/page/ui/file-drop.js","../../src/js/page/ui/preloader.js","../../src/js/page/ui/changelog.js","../../src/js/page/ui/results-container.js","../../src/js/page/ui/view-toggler.js","../../src/js/page/results-cache.js","../../src/js/page/ui/main-ui.js","../../src/js/page/main-controller.js","../../src/js/page/svgo.js","../../src/js/page/index.js"],"sourcesContent":["export const domReady = new Promise((resolve) => {\n  function checkState() {\n    if (document.readyState !== 'loading') resolve();\n  }\n\n  document.addEventListener('readystatechange', checkState);\n  checkState();\n});\n\nconst range = document.createRange();\nrange.selectNode(document.documentElement);\n\nexport function strToEl(str) {\n  return range.createContextualFragment(String(str)).children[0];\n}\n\nconst entityMap = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  \"'\": '&#39;',\n  '/': '&#x2F;',\n};\n\nexport function escapeHTML(str) {\n  return String(str).replace(/[&<>\"'/]/g, (s) => entityMap[s]);\n}\n\nexport function escapeHtmlTag(strings, ...values) {\n  values = values.map((s) => escapeHTML(s));\n  return strings.reduce((str, val, i) => str + val + (values[i] || ''), '');\n}\n\nexport function readFileAsText(file) {\n  return new Response(file).text();\n}\n\nfunction transitionClassFunc({ removeClass = false } = {}) {\n  return (element, className = 'active', transitionClass = 'transition') => {\n    const hasClass = element.classList.contains(className);\n\n    if (removeClass) {\n      if (!hasClass) return Promise.resolve();\n    } else if (hasClass) {\n      return Promise.resolve();\n    }\n\n    const transitionEnd = new Promise((resolve) => {\n      const listener = (event) => {\n        if (event.target !== element) return;\n        element.removeEventListener('transitionend', listener);\n        element.classList.remove(transitionClass);\n        resolve();\n      };\n\n      element.classList.add(transitionClass);\n\n      requestAnimationFrame(() => {\n        element.addEventListener('transitionend', listener);\n        element.classList[removeClass ? 'remove' : 'add'](className);\n      });\n    });\n\n    const transitionTimeout = new Promise((resolve) => {\n      setTimeout(resolve, 1000);\n    });\n\n    return Promise.race([transitionEnd, transitionTimeout]);\n  };\n}\n\nexport const transitionToClass = transitionClassFunc();\nexport const transitionFromClass = transitionClassFunc({ removeClass: true });\n\nexport function trackFocusMethod() {\n  let focusMethod = 'mouse';\n\n  document.body.addEventListener(\n    'focus',\n    (event) => {\n      event.target.classList.add(\n        focusMethod === 'key' ? 'key-focused' : 'mouse-focused',\n      );\n    },\n    true,\n  );\n\n  document.body.addEventListener(\n    'blur',\n    (event) => {\n      event.target.classList.remove('key-focused', 'mouse-focused');\n    },\n    true,\n  );\n\n  document.body.addEventListener(\n    'keydown',\n    () => {\n      focusMethod = 'key';\n    },\n    true,\n  );\n\n  document.body.addEventListener(\n    'mousedown',\n    () => {\n      focusMethod = 'mouse';\n    },\n    true,\n  );\n}\n","export const idbKeyval = (() => {\n  let dbInstance;\n\n  function getDB() {\n    if (dbInstance) return dbInstance;\n\n    dbInstance = new Promise((resolve, reject) => {\n      const openreq = indexedDB.open('svgo-keyval', 1);\n\n      openreq.onerror = () => {\n        reject(openreq.error);\n      };\n\n      openreq.onupgradeneeded = () => {\n        // First time setup: create an empty object store\n        openreq.result.createObjectStore('keyval');\n      };\n\n      openreq.onsuccess = () => {\n        resolve(openreq.result);\n      };\n    });\n\n    return dbInstance;\n  }\n\n  async function withStore(type, callback) {\n    const db = await getDB();\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction('keyval', type);\n      transaction.oncomplete = () => resolve();\n      transaction.onerror = () => reject(transaction.error);\n      callback(transaction.objectStore('keyval'));\n    });\n  }\n\n  return {\n    async get(key) {\n      let request;\n      await withStore('readonly', (store) => {\n        request = store.get(key);\n      });\n      return request.result;\n    },\n    set(key, value) {\n      return withStore('readwrite', (store) => {\n        store.put(value, key);\n      });\n    },\n    delete(key) {\n      return withStore('readwrite', (store) => {\n        store.delete(key);\n      });\n    },\n  };\n})();\n","export default class WorkerMessenger {\n  constructor(url) {\n    this._requestId = 0;\n    // worker jobs awaiting response { [requestId]: [ resolve, reject ] }\n    this._pending = {};\n    this._url = url;\n    this._worker = null;\n  }\n\n  release() {\n    this._abortPending();\n    if (this._worker) {\n      this._worker.terminate();\n      this._worker = null;\n    }\n  }\n\n  requestResponse(message) {\n    return new Promise((resolve, reject) => {\n      message.id = ++this._requestId;\n      this._pending[message.id] = [resolve, reject];\n\n      if (!this._worker) this._startWorker();\n      this._worker.postMessage(message);\n    });\n  }\n\n  abort() {\n    if (Object.keys(this._pending).length === 0) return;\n\n    this._abortPending();\n    if (this._worker) this._worker.terminate();\n    this._startWorker();\n  }\n\n  _abortPending() {\n    for (const key of Object.keys(this._pending)) {\n      this._fulfillPending(\n        key,\n        null,\n        new DOMException('AbortError', 'AbortError'),\n      );\n    }\n  }\n\n  _startWorker() {\n    this._worker = new Worker(this._url);\n    this._worker.onmessage = (event) => this._onMessage(event);\n  }\n\n  _onMessage(event) {\n    if (!event.data.id) {\n      console.log('Unexpected message', event);\n      return;\n    }\n\n    this._fulfillPending(\n      event.data.id,\n      event.data.result,\n      event.data.error && new Error(event.data.error),\n    );\n  }\n\n  _fulfillPending(id, result, error) {\n    const resolver = this._pending[id];\n\n    if (!resolver) {\n      console.log('No resolver for', { id, result, error });\n      return;\n    }\n\n    delete this._pending[id];\n\n    if (error) {\n      resolver[1](error);\n      return;\n    }\n\n    resolver[0](result);\n  }\n}\n","import WorkerMessenger from './worker-messenger.js';\n\nclass Gzip extends WorkerMessenger {\n  constructor() {\n    super('js/gzip-worker.js');\n  }\n\n  compress(data) {\n    return this.requestResponse({ data });\n  }\n}\n\nexport const gzip = new Gzip();\n","import { gzip } from './gzip.js';\n\nexport default class SvgFile {\n  constructor(text, width, height) {\n    this.text = text;\n    this._compressedSize = null;\n    this._url = null;\n    this.width = width;\n    this.height = height;\n  }\n\n  async size({ compress }) {\n    if (!compress) return this.text.length;\n\n    if (!this._compressedSize) {\n      this._compressedSize = gzip\n        .compress(this.text)\n        .then((response) => response.byteLength);\n    }\n\n    return this._compressedSize;\n  }\n\n  get url() {\n    if (!this._url) {\n      this._url = URL.createObjectURL(\n        new Blob([this.text], { type: 'image/svg+xml' }),\n      );\n    }\n\n    return this._url;\n  }\n\n  release() {\n    if (!this._url) return;\n\n    URL.revokeObjectURL(this._url);\n  }\n}\n","function getXY(obj) {\n  return {\n    x: obj.pageX,\n    y: obj.pageY,\n  };\n}\n\nfunction touchDistance(touch1, touch2) {\n  const dx = Math.abs(touch2.x - touch1.x);\n  const dy = Math.abs(touch2.y - touch1.y);\n  return Math.hypot(dx, dy);\n}\n\nfunction getMidpoint(point1, point2) {\n  return {\n    x: (point1.x + point2.x) / 2,\n    y: (point1.y + point2.y) / 2,\n  };\n}\n\nfunction getPoints(event) {\n  return event.touches\n    ? [...event.touches].map((touch) => getXY(touch))\n    : [getXY(event)];\n}\n\nexport default class PanZoom {\n  constructor(\n    target,\n    { eventArea = target, shouldCaptureFunc = () => true } = {},\n  ) {\n    this._target = target;\n    this._shouldCaptureFunc = shouldCaptureFunc;\n    this._dx = 0;\n    this._dy = 0;\n    this._scale = 1;\n    this._active = 0;\n    this._lastPoints = [];\n\n    // TODO: revisit this later\n    // Ideally these would use public class fields, but around 1.7% of users\n    // are on old Safari versions that don't support them. We should be able\n    // to switch over soon.\n    this._onPointerDown = (event) => {\n      if (event.type === 'mousedown' && event.button !== 0) return;\n      if (!this._shouldCaptureFunc(event.target)) return;\n      event.preventDefault();\n\n      this._lastPoints = getPoints(event);\n      this._active++;\n\n      if (this._active === 1) this._onFirstPointerDown();\n    };\n\n    this._onPointerMove = (event) => {\n      event.preventDefault();\n      const points = getPoints(event);\n      /* eslint-disable unicorn/no-array-reduce, unicorn/no-array-callback-reference */\n      const averagePoint = points.reduce(getMidpoint);\n      const averageLastPoint = this._lastPoints.reduce(getMidpoint);\n      /* eslint-enable unicorn/no-array-reduce, unicorn/no-array-callback-reference */\n      const { left, top } = this._target.getBoundingClientRect();\n\n      this._dx += averagePoint.x - averageLastPoint.x;\n      this._dy += averagePoint.y - averageLastPoint.y;\n\n      if (points[1]) {\n        const scaleDiff =\n          touchDistance(points[0], points[1]) /\n          touchDistance(this._lastPoints[0], this._lastPoints[1]);\n        this._scale *= scaleDiff;\n        this._dx -= (averagePoint.x - left) * (scaleDiff - 1);\n        this._dy -= (averagePoint.y - top) * (scaleDiff - 1);\n      }\n\n      this._update();\n      this._lastPoints = points;\n    };\n\n    this._onPointerUp = (event) => {\n      event.preventDefault();\n      this._active--;\n      this._lastPoints.pop();\n\n      if (this._active) {\n        this._lastPoints = getPoints(event);\n        return;\n      }\n\n      document.removeEventListener('mousemove', this._onPointerMove);\n      document.removeEventListener('mouseup', this._onPointerUp);\n      document.removeEventListener('touchmove', this._onPointerMove);\n      document.removeEventListener('touchend', this._onPointerUp);\n    };\n\n    // bound events\n    eventArea.addEventListener('mousedown', this._onPointerDown);\n    eventArea.addEventListener('touchstart', this._onPointerDown);\n\n    // unbound\n    eventArea.addEventListener('wheel', (event) => this._onWheel(event));\n  }\n\n  reset() {\n    this._dx = 0;\n    this._dy = 0;\n    this._scale = 1;\n    this._update();\n  }\n\n  _onWheel(event) {\n    if (!this._shouldCaptureFunc(event.target)) return;\n    event.preventDefault();\n\n    const { left, top } = this._target.getBoundingClientRect();\n    let delta = event.deltaY;\n\n    // 1 is \"lines\", 0 is \"pixels\"\n    // Firefox uses \"lines\" when mouse is connected\n    if (event.deltaMode === 1) {\n      delta *= 15;\n    }\n\n    // stop mouse wheel producing huge values\n    delta = Math.max(Math.min(delta, 60), -60);\n\n    const scaleDiff = delta / 300 + 1;\n\n    // avoid to-small values\n    if (this._scale * scaleDiff < 0.05) return;\n\n    this._scale *= scaleDiff;\n    this._dx -= (event.pageX - left) * (scaleDiff - 1);\n    this._dy -= (event.pageY - top) * (scaleDiff - 1);\n    this._update();\n  }\n\n  _onFirstPointerDown() {\n    document.addEventListener('mousemove', this._onPointerMove);\n    document.addEventListener('mouseup', this._onPointerUp);\n    document.addEventListener('touchmove', this._onPointerMove);\n    document.addEventListener('touchend', this._onPointerUp);\n  }\n\n  _update() {\n    this._target.style.transform = `translate3d(${this._dx}px, ${this._dy}px, 0) scale(${this._scale})`;\n  }\n}\n","import { domReady, strToEl } from '../utils.js';\nimport PanZoom from './pan-zoom.js';\n\nexport default class SvgOutput {\n  constructor() {\n    // prettier-ignore\n    this.container = strToEl(\n      '<div class=\"svg-output\">' +\n        '<div class=\"svg-container\">' +\n          '<iframe class=\"svg-frame\" sandbox=\"allow-scripts\" scrolling=\"no\" title=\"Loaded SVG file\"></iframe>' +\n        '</div>' +\n      '</div>'\n    );\n\n    this._svgFrame = this.container.querySelector('.svg-frame');\n    this._svgContainer = this.container.querySelector('.svg-container');\n\n    domReady.then(() => {\n      this._panZoom = new PanZoom(this._svgContainer, {\n        eventArea: this.container,\n      });\n    });\n  }\n\n  setSvg({ text, width, height }) {\n    // TODO: revisit this\n    // I would rather use blob urls, but they don't work in Firefox\n    // All the internal refs break.\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1125667\n    const nextLoad = this._nextLoadPromise();\n    this._svgFrame.src = `data:image/svg+xml,${encodeURIComponent(text)}`;\n    this._svgFrame.style.width = `${width}px`;\n    this._svgFrame.style.height = `${height}px`;\n    return nextLoad;\n  }\n\n  reset() {\n    this._svgFrame.src = 'about:blank';\n    this._panZoom.reset();\n  }\n\n  _nextLoadPromise() {\n    return new Promise((resolve) => {\n      const onload = () => {\n        this._svgFrame.removeEventListener('load', onload);\n        resolve();\n      };\n\n      this._svgFrame.addEventListener('load', onload);\n    });\n  }\n}\n","import { strToEl } from '../utils.js';\nimport Prism from '../prism.js';\n\nconst prism = new Prism();\n\nexport default class CodeOutput {\n  constructor() {\n    // prettier-ignore\n    this.container = strToEl(\n      '<div class=\"code-output\">' +\n        '<pre><code></code></pre>' +\n      '</div>'\n    );\n    this._codeEl = this.container.querySelector('code');\n  }\n\n  async setSvg({ text }) {\n    this._codeEl.innerHTML = await prism.highlight(text);\n  }\n\n  reset() {\n    this._codeEl.innerHTML = '';\n  }\n}\n","import WorkerMessenger from './worker-messenger.js';\n\nexport default class Prism extends WorkerMessenger {\n  constructor() {\n    super('js/prism-worker.js');\n  }\n\n  highlight(data) {\n    return this.requestResponse({ data });\n  }\n}\n","import { strToEl, transitionToClass, transitionFromClass } from '../utils.js';\nimport SvgOutput from './svg-output.js';\nimport CodeOutput from './code-output.js';\n\nexport default class Output {\n  constructor() {\n    this.container = strToEl('<div class=\"output-switcher\"></div>');\n\n    this._types = {\n      image: new SvgOutput(),\n      code: new CodeOutput(),\n    };\n\n    this._svgFile = null;\n    this._switchQueue = Promise.resolve();\n    this.set('image', { noAnimate: true });\n  }\n\n  update(svgFile) {\n    this._svgFile = svgFile;\n    return this._types[this._activeType].setSvg(svgFile);\n  }\n\n  reset() {\n    this._types[this._activeType].reset();\n  }\n\n  set(type, { noAnimate = false } = {}) {\n    this._switchQueue = this._switchQueue.then(async () => {\n      const toRemove =\n        this._activeType && this._types[this._activeType].container;\n\n      this._activeType = type;\n      const toAdd = this._types[this._activeType].container;\n      this.container.append(toAdd);\n\n      if (this._svgFile) await this.update(this._svgFile);\n\n      if (noAnimate) {\n        toAdd.classList.add('active');\n        if (toRemove) toRemove.classList.remove('active');\n      } else {\n        const transitions = [transitionToClass(toAdd)];\n\n        if (toRemove) transitions.push(transitionFromClass(toRemove));\n\n        await Promise.all(transitions);\n      }\n\n      if (toRemove) toRemove.remove();\n    });\n\n    return this._switchQueue;\n  }\n}\n","import { strToEl } from '../utils.js';\n\nexport default class Ripple {\n  constructor() {\n    this.container = strToEl('<span class=\"ripple\"></span>');\n  }\n\n  animate() {\n    this.container.classList.remove('animate');\n    this.container.offsetLeft; // eslint-disable-line no-unused-expressions\n    this.container.classList.add('animate');\n  }\n}\n","import { strToEl } from '../utils.js';\nimport Ripple from './ripple.js';\n\nexport default class FloatingActionButton {\n  constructor({ title, href, iconSvg, major = false }) {\n    // prettier-ignore\n    this.container = strToEl(\n      (href ? '<a>' : '<button class=\"unbutton\" type=\"button\">') +\n        iconSvg +\n      (href ? '</a>' : '</button>')\n    );\n\n    const classes = ['floating-action-button'];\n\n    if (href) this.container.href = href;\n    if (title) this.container.setAttribute('title', title);\n    if (major) classes.push('major-floating-action-button');\n\n    this.container.classList.add(...classes);\n\n    this._ripple = new Ripple();\n    this.container.append(this._ripple.container);\n    this.container.addEventListener('click', () => this.onClick());\n  }\n\n  onClick() {\n    this._ripple.animate();\n  }\n}\n","import { strToEl } from '../utils.js';\n\nexport default class Spinner {\n  constructor() {\n    // prettier-ignore\n    this.container = strToEl(\n      '<div class=\"spinner\">' +\n        '<div class=\"spinner-container\">' +\n          '<div class=\"spinner-layer\">' +\n            '<div class=\"circle-clipper left\">' +\n              '<div class=\"circle\"></div>' +\n            '</div>' +\n            '<div class=\"gap-patch\">' +\n              '<div class=\"circle\"></div>' +\n            '</div>' +\n            '<div class=\"circle-clipper right\">' +\n              '<div class=\"circle\"></div>' +\n            '</div>' +\n          '</div>' +\n        '</div>' +\n      '</div>'\n    );\n\n    this._showTimeout = null;\n    this.container.style.display = 'none';\n\n    this.container.addEventListener('animationend', (event) => {\n      if (event.target === this.container) {\n        this.container.style.display = 'none';\n      }\n    });\n  }\n\n  show(delay = 300) {\n    clearTimeout(this._showTimeout);\n    this.container.style.display = 'none';\n    this.container.classList.remove('cooldown');\n    this._showTimeout = setTimeout(() => {\n      this.container.style.display = '';\n    }, delay);\n  }\n\n  hide() {\n    clearTimeout(this._showTimeout);\n    this.container.classList.add('cooldown');\n  }\n}\n","import FloatingActionButton from './floating-action-button.js';\nimport Spinner from './spinner.js';\n\nexport default class DownloadButton extends FloatingActionButton {\n  constructor() {\n    const title = 'Download';\n\n    super({\n      title,\n      href: './',\n      iconSvg:\n        // prettier-ignore\n        '<svg aria-hidden=\"true\" class=\"icon\" viewBox=\"0 0 24 24\">' +\n          '<path d=\"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z\"/>' +\n        '</svg>',\n      major: true,\n    });\n\n    this._spinner = new Spinner();\n    this.container.append(this._spinner.container);\n  }\n\n  setDownload(filename, { url }) {\n    this.container.download = filename;\n    this.container.href = url;\n  }\n\n  working() {\n    this._spinner.show(500);\n  }\n\n  done() {\n    this._spinner.hide();\n  }\n}\n","import FloatingActionButton from './floating-action-button.js';\n\nexport default class CopyButton extends FloatingActionButton {\n  constructor() {\n    const title = 'Copy as text';\n\n    super({\n      title,\n      iconSvg:\n        // prettier-ignore\n        '<svg aria-hidden=\"true\" class=\"icon\" viewBox=\"0 0 24 24\">' +\n          '<path d=\"M16 1H4C3 1 2 2 2 3v14h2V3h12V1zm3 4H8C7 5 6 6 6 7v14c0 1 1 2 2 2h11c1 0 2-1 2-2V7c0-1-1-2-2-2zm0 16H8V7h11v14z\"/>' +\n        '</svg>',\n    });\n\n    this._text = null;\n    this._pre = document.createElement('pre');\n  }\n\n  onClick(event) {\n    super.onClick(event);\n    this.copyText();\n  }\n\n  copyText() {\n    if (!this._text) return false;\n\n    this._pre.textContent = this._text;\n    document.body.append(this._pre);\n    getSelection().removeAllRanges();\n\n    const range = document.createRange();\n    range.selectNode(this._pre);\n\n    window.getSelection().addRange(range);\n\n    document.execCommand('copy');\n    getSelection().removeAllRanges();\n    this._pre.remove();\n\n    return true;\n  }\n\n  setCopyText(text) {\n    this._text = text;\n  }\n}\n","import FloatingActionButton from './floating-action-button.js';\n\nexport default class BgFillButton extends FloatingActionButton {\n  constructor() {\n    const title = 'Preview on vivid background';\n\n    super({\n      title,\n      iconSvg:\n        // prettier-ignore\n        '<svg aria-hidden=\"true\" class=\"icon\" viewBox=\"0 0 24 24\">' +\n          '<path fill=\"currentColor\" d=\"M21.143 9.667c-.733-1.392-1.914-3.05-3.617-4.753C14.549 1.936 12.048 1 10.741 1c-.414 0-.708.094-.86.246L8.52 2.606c-1.899-.236-3.42.106-4.294.983-.876.875-1.164 2.159-.792 3.523.492 1.806 2.305 4.049 5.905 5.375.038.323.157.638.405.885.588.588 1.535.586 2.121 0s.588-1.533.002-2.119a1.5 1.5 0 0 0-2.123-.001l-.17.256c-2.031-.765-3.395-1.828-4.232-2.9l3.879-3.875c.496 2.73 6.432 8.676 9.178 9.178l-7.115 7.107c-.234.153-2.798-.316-6.156-3.675-3.393-3.393-3.175-5.271-3.027-5.498L3.96 9.989C3.521 9.63 3.035 8.886 2.819 8.3L.685 10.431C.24 10.877 0 11.495 0 12.251c0 1.634 1.121 3.915 3.713 6.506C6.477 21.521 9.293 23 11.145 23c.648 0 1.18-.195 1.547-.562l8.086-8.078c.91.874-.778 3.538-.778 4.648a2 2 0 0 0 4-.001c0-3.184-1.425-6.81-2.857-9.34zM4.934 4.296c.527-.53 1.471-.791 2.656-.761L4.381 6.741c-.236-.978-.049-1.845.553-2.445zm9.292 4.079-.03-.029C12.904 7.054 10.393 3.99 11.1 3.283c.715-.715 3.488 1.521 5.062 3.096.862.862 2.088 2.247 2.937 3.458-1.717-1.074-3.491-1.469-4.873-1.462z\"/>' +\n        '</svg>',\n    });\n  }\n\n  onClick(event) {\n    super.onClick(event);\n\n    if (this.container.classList.contains('active')) {\n      this.container.classList.remove('active');\n      document.documentElement.classList.remove('bg-dark');\n    } else {\n      this.container.classList.add('active');\n      document.documentElement.classList.add('bg-dark');\n    }\n  }\n}\n","import { strToEl } from '../utils.js';\n\nfunction round(num, places) {\n  const mult = 10 ** places;\n  return Math.floor(Math.round(num * mult)) / mult;\n}\n\nfunction humanSize(bytes) {\n  return bytes < 1024 ? `${bytes} bytes` : `${round(bytes / 1024, 2)}k`;\n}\n\nexport default class Results {\n  constructor() {\n    // prettier-ignore\n    this.container = strToEl(\n      '<div class=\"results\">' +\n        '<span class=\"size\"></span> ' +\n        '<span class=\"diff\"></span>' +\n      '</div>'\n    );\n\n    this._sizeEl = this.container.querySelector('.size');\n    this._diffEl = this.container.querySelector('.diff');\n  }\n\n  update({ size, comparisonSize }) {\n    this._sizeEl.textContent = comparisonSize\n      ? `${humanSize(comparisonSize)} â†’ ${humanSize(size)}`\n      : humanSize(size);\n\n    this._diffEl.classList.remove('decrease', 'increase');\n\n    // just displaying a single size?\n    if (!comparisonSize) {\n      this._diffEl.textContent = '';\n    } else if (size === comparisonSize) {\n      this._diffEl.textContent = '100%';\n    } else {\n      this._diffEl.textContent = `${round((size / comparisonSize) * 100, 2)}%`;\n      this._diffEl.classList.add(\n        size > comparisonSize ? 'increase' : 'decrease',\n      );\n    }\n  }\n}\n","export let createNanoEvents = () => ({\n  events: {},\n  emit(event, ...args) {\n    let callbacks = this.events[event] || []\n    for (let i = 0, length = callbacks.length; i < length; i++) {\n      callbacks[i](...args)\n    }\n  },\n  on(event, cb) {\n    this.events[event]?.push(cb) || (this.events[event] = [cb])\n    return () => {\n      this.events[event] = this.events[event]?.filter(i => cb !== i)\n    }\n  }\n})\n","import { strToEl } from '../utils.js';\n\nexport default class MaterialSlider {\n  constructor(rangeElement) {\n    // prettier-ignore\n    this.container = strToEl(\n      '<div class=\"material-slider\">' +\n        '<div class=\"track\">' +\n          '<div class=\"track-on\"></div>' +\n          '<div class=\"handle\">' +\n            '<div class=\"arrow\"></div>' +\n            '<div class=\"val\"></div>' +\n          '</div>' +\n        '</div>' +\n      '</div>'\n    );\n\n    this._range = rangeElement;\n    this._handle = this.container.querySelector('.handle');\n    this._trackOn = this.container.querySelector('.track-on');\n    this._val = this.container.querySelector('.val');\n\n    this._range.parentNode.insertBefore(this.container, this._range);\n    this.container.insertBefore(this._range, this.container.firstChild);\n\n    this._range.addEventListener('input', () => this._onInputChange());\n    this._range.addEventListener('mousedown', () => this._onRangeMouseDown());\n    this._range.addEventListener('touchstart', () => this._onRangeTouchStart());\n    this._range.addEventListener('touchend', () => this._onRangeTouchEnd());\n\n    this._setPosition();\n  }\n\n  // eslint-disable-next-line accessor-pairs\n  set value(newValue) {\n    this._range.value = newValue;\n    this._update();\n  }\n\n  _onRangeTouchStart() {\n    this._range.focus();\n  }\n\n  _onRangeTouchEnd() {\n    this._range.blur();\n  }\n\n  _onRangeMouseDown() {\n    this._range.classList.add('active');\n\n    const upListener = () => {\n      requestAnimationFrame(() => {\n        this._range.blur();\n      });\n      this._range.classList.remove('active');\n      document.removeEventListener('mouseup', upListener);\n    };\n\n    document.addEventListener('mouseup', upListener);\n  }\n\n  _onInputChange() {\n    this._update();\n  }\n\n  _update() {\n    requestAnimationFrame(() => this._setPosition());\n  }\n\n  _setPosition() {\n    const { min, max, value } = this._range;\n    const percent = (Number(value) - min) / (max - min);\n\n    this._trackOn.style.width = this._handle.style.left = `${percent * 100}%`;\n    this._val.textContent = value;\n  }\n}\n","import { createNanoEvents } from 'nanoevents';\nimport { domReady } from '../utils.js';\nimport MaterialSlider from './material-slider.js';\nimport Ripple from './ripple.js';\n\nexport default class Settings {\n  constructor() {\n    this.emitter = createNanoEvents();\n    this._throttleTimeout = null;\n\n    domReady.then(() => {\n      this.container = document.querySelector('.settings');\n      this._pluginInputs = [\n        ...this.container.querySelectorAll('.plugins input'),\n      ];\n      this._globalInputs = [\n        ...this.container.querySelectorAll('.global input'),\n      ];\n\n      const scroller = this.container.querySelector('.settings-scroller');\n      const resetBtn = this.container.querySelector('.setting-reset');\n      const ranges = this.container.querySelectorAll('input[type=range]');\n\n      this._resetRipple = new Ripple();\n      resetBtn.append(this._resetRipple.container);\n\n      // map real range elements to Slider instances\n      this._sliderMap = new WeakMap();\n\n      // enhance ranges\n      for (const range of ranges) {\n        this._sliderMap.set(range, new MaterialSlider(range));\n      }\n\n      this.container.addEventListener('input', (event) =>\n        this._onChange(event),\n      );\n      resetBtn.addEventListener('click', () => this._onReset());\n\n      // TODO: revisit this\n      // Stop double-tap text selection.\n      // This stops all text selection which is kinda sad.\n      // I think this code will bite me.\n      scroller.addEventListener('mousedown', (event) => {\n        if (event.target.closest('input[type=range]')) return;\n        event.preventDefault();\n      });\n    });\n  }\n\n  _onChange(event) {\n    clearTimeout(this._throttleTimeout);\n\n    // throttle range\n    if (event.target.type === 'range') {\n      this._throttleTimeout = setTimeout(\n        () => this.emitter.emit('change'),\n        150,\n      );\n    } else {\n      this.emitter.emit('change');\n    }\n  }\n\n  _onReset() {\n    this._resetRipple.animate();\n    const oldSettings = this.getSettings();\n\n    // Set all inputs according to their initial attributes\n    for (const inputEl of this._globalInputs) {\n      if (inputEl.type === 'checkbox') {\n        inputEl.checked = inputEl.hasAttribute('checked');\n      } else if (inputEl.type === 'range') {\n        this._sliderMap.get(inputEl).value = inputEl.getAttribute('value');\n      }\n    }\n\n    for (const inputEl of this._pluginInputs) {\n      inputEl.checked = inputEl.hasAttribute('checked');\n    }\n\n    this.emitter.emit('reset', oldSettings);\n    this.emitter.emit('change');\n  }\n\n  setSettings(settings) {\n    for (const inputEl of this._globalInputs) {\n      if (!(inputEl.name in settings)) continue;\n\n      if (inputEl.type === 'checkbox') {\n        inputEl.checked = settings[inputEl.name];\n      } else if (inputEl.type === 'range') {\n        this._sliderMap.get(inputEl).value = settings[inputEl.name];\n      }\n    }\n\n    for (const inputEl of this._pluginInputs) {\n      if (!(inputEl.name in settings.plugins)) continue;\n      inputEl.checked = settings.plugins[inputEl.name];\n    }\n  }\n\n  getSettings() {\n    // fingerprint is used for cache lookups\n    const fingerprint = [];\n    const output = {\n      plugins: {},\n    };\n\n    for (const inputEl of this._globalInputs) {\n      if (inputEl.name !== 'gzip' && inputEl.name !== 'original') {\n        if (inputEl.type === 'checkbox') {\n          fingerprint.push(Number(inputEl.checked));\n        } else {\n          fingerprint.push(`|${inputEl.value}|`);\n        }\n      }\n\n      output[inputEl.name] =\n        inputEl.type === 'checkbox' ? inputEl.checked : inputEl.value;\n    }\n\n    for (const inputEl of this._pluginInputs) {\n      fingerprint.push(Number(inputEl.checked));\n      output.plugins[inputEl.name] = inputEl.checked;\n    }\n\n    output.fingerprint = fingerprint.join(',');\n\n    return output;\n  }\n}\n","import { createNanoEvents } from 'nanoevents';\nimport {\n  domReady,\n  transitionFromClass,\n  transitionToClass,\n  readFileAsText,\n} from '../utils.js';\nimport Spinner from './spinner.js';\n\nexport default class MainMenu {\n  constructor() {\n    this.emitter = createNanoEvents();\n    this.allowHide = false;\n    this._spinner = new Spinner();\n\n    domReady.then(() => {\n      this.container = document.querySelector('.main-menu');\n      this._loadFileInput = this.container.querySelector('.load-file-input');\n      this._pasteInput = this.container.querySelector('.paste-input');\n      this._loadDemoBtn = this.container.querySelector('.load-demo');\n      this._loadFileBtn = this.container.querySelector('.load-file');\n      this._pasteLabel = this.container.querySelector('.menu-input');\n      this._overlay = this.container.querySelector('.overlay');\n      this._menu = this.container.querySelector('.menu');\n      const menuBtn = document.querySelector('.menu-btn');\n\n      menuBtn.addEventListener('click', (event) =>\n        this._onMenuButtonClick(event),\n      );\n      this._overlay.addEventListener('click', (event) =>\n        this._onOverlayClick(event),\n      );\n      this._loadFileBtn.addEventListener('click', (event) =>\n        this._onLoadFileClick(event),\n      );\n      this._loadDemoBtn.addEventListener('click', (event) =>\n        this._onLoadDemoClick(event),\n      );\n      this._loadFileInput.addEventListener('change', () =>\n        this._onFileInputChange(),\n      );\n      this._pasteInput.addEventListener('input', () =>\n        this._onTextInputChange(),\n      );\n    });\n  }\n\n  show() {\n    this.container.classList.remove('hidden');\n    transitionFromClass(this._overlay, 'hidden');\n    transitionFromClass(this._menu, 'hidden');\n  }\n\n  hide() {\n    if (!this.allowHide) return;\n    this.stopSpinner();\n    this.container.classList.add('hidden');\n    transitionToClass(this._overlay, 'hidden');\n    transitionToClass(this._menu, 'hidden');\n  }\n\n  stopSpinner() {\n    this._spinner.hide();\n  }\n\n  showFilePicker() {\n    this._loadFileInput.click();\n  }\n\n  setPasteInput(value) {\n    this._pasteInput.value = value;\n    this._pasteInput.dispatchEvent(new Event('input'));\n  }\n\n  _onOverlayClick(event) {\n    event.preventDefault();\n    this.hide();\n  }\n\n  _onMenuButtonClick(event) {\n    event.preventDefault();\n    this.show();\n  }\n\n  _onTextInputChange() {\n    const value = this._pasteInput.value;\n    if (!value.includes('</svg>')) return;\n\n    this._pasteInput.value = '';\n    this._pasteInput.blur();\n\n    this._pasteLabel.append(this._spinner.container);\n    this._spinner.show();\n\n    this.emitter.emit('svgDataLoad', {\n      data: value,\n      filename: 'image.svg',\n    });\n  }\n\n  _onLoadFileClick(event) {\n    event.preventDefault();\n    event.target.blur();\n    this.showFilePicker();\n  }\n\n  async _onFileInputChange() {\n    const file = this._loadFileInput.files[0];\n\n    if (!file) return;\n\n    this._loadFileBtn.append(this._spinner.container);\n    this._spinner.show();\n\n    this.emitter.emit('svgDataLoad', {\n      data: await readFileAsText(file),\n      filename: file.name,\n    });\n  }\n\n  async _onLoadDemoClick(event) {\n    event.preventDefault();\n    event.target.blur();\n    this._loadDemoBtn.append(this._spinner.container);\n    this._spinner.show();\n\n    try {\n      const data = await fetch('test-svgs/car-lite.svg').then((response) =>\n        response.text(),\n      );\n      this.emitter.emit('svgDataLoad', {\n        data,\n        filename: 'car-lite.svg',\n      });\n    } catch {\n      this.stopSpinner();\n\n      const error = new Error(\"Couldn't fetch demo SVG\");\n\n      this.emitter.emit('error', { error });\n    }\n  }\n}\n","import { strToEl, transitionToClass } from '../utils.js';\n\nclass Toast {\n  constructor(message, duration, buttons, isError) {\n    this.container = strToEl(\n      '<div class=\"toast\"><div class=\"toast-content\"></div></div>',\n    );\n    const content = this.container.querySelector('.toast-content');\n    this._answerResolve = null;\n    this._hideTimeout = null;\n\n    if (isError) {\n      content.insertAdjacentHTML('afterbegin', '<pre><code></code></pre>');\n      content.querySelector('code').textContent = message;\n    } else {\n      content.textContent = message;\n    }\n\n    this.answer = new Promise((resolve) => {\n      this._answerResolve = resolve;\n    });\n\n    for (const button of buttons) {\n      const buttonElement = document.createElement('button');\n      buttonElement.className = 'unbutton';\n      buttonElement.textContent = button;\n      buttonElement.type = 'button';\n      buttonElement.addEventListener('click', () => {\n        this._answerResolve(button);\n      });\n      this.container.append(buttonElement);\n    }\n\n    if (duration) {\n      this._hideTimeout = setTimeout(() => this.hide(), duration);\n    }\n  }\n\n  hide() {\n    clearTimeout(this._hideTimeout);\n    this._answerResolve();\n    return transitionToClass(this.container, 'hide');\n  }\n}\n\nexport default class Toasts {\n  constructor() {\n    this.container = strToEl('<div class=\"toasts\"></div>');\n  }\n\n  show(message, { duration = 0, buttons = ['dismiss'], isError = false } = {}) {\n    const toast = new Toast(message, duration, buttons, isError);\n    this.container.append(toast.container);\n\n    toast.answer\n      .then(() => toast.hide())\n      .then(() => {\n        toast.container.remove();\n      });\n\n    return toast;\n  }\n}\n","import { createNanoEvents } from 'nanoevents';\nimport {\n  strToEl,\n  domReady,\n  transitionToClass,\n  transitionFromClass,\n  readFileAsText,\n} from '../utils.js';\n\nexport default class FileDrop {\n  constructor() {\n    this.emitter = createNanoEvents();\n    this.container = strToEl('<div class=\"drop-overlay\">Drop it!</div>');\n\n    // drag events are horrid\n    this._activeEnters = 0;\n    this._currentEnteredElement = null;\n\n    domReady.then(() => {\n      document.addEventListener('dragover', (event) => event.preventDefault());\n      document.addEventListener('dragenter', (event) =>\n        this._onDragEnter(event),\n      );\n      document.addEventListener('dragleave', () => this._onDragLeave());\n      document.addEventListener('drop', (event) => this._onDrop(event));\n    });\n  }\n\n  _onDragEnter(event) {\n    // TODO: revisit this\n    // Firefox double-fires on window enter, this works around it\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1124645\n    if (this._currentEnteredElement === event.target) return;\n    this._currentEnteredElement = event.target;\n\n    if (!this._activeEnters++) {\n      transitionToClass(this.container);\n    }\n  }\n\n  _onDragLeave() {\n    this._currentEnteredElement = null;\n\n    if (!--this._activeEnters) {\n      transitionFromClass(this.container);\n    }\n  }\n\n  async _onDrop(event) {\n    event.preventDefault();\n\n    this._activeEnters = 0;\n    transitionFromClass(this.container);\n\n    const file = event.dataTransfer.files[0];\n    if (!file) return;\n\n    this.emitter.emit('svgDataLoad', {\n      data: await readFileAsText(file),\n      filename: file.name,\n    });\n  }\n}\n","import { domReady, transitionFromClass } from '../utils.js';\n\nexport default class Preloader {\n  constructor() {\n    domReady.then(() => {\n      this.container = document.querySelector('.preloader');\n      this.activated = this.container.classList.contains('active');\n      this.hide();\n    });\n  }\n\n  async hide() {\n    await transitionFromClass(this.container, 'active');\n    this.container.style.display = 'none';\n  }\n}\n","import {\n  strToEl,\n  escapeHtmlTag,\n  transitionToClass,\n  domReady,\n} from '../utils.js';\n\nexport default class Changelog {\n  constructor(loadedVersion) {\n    this.container = strToEl('<section class=\"changelog\"></section>');\n    this._loadedVersion = loadedVersion;\n  }\n\n  async showLogFrom(lastLoadedVersion) {\n    if (lastLoadedVersion === this._loadedVersion) return;\n    const changelog = await fetch('changelog.json').then((response) =>\n      response.json(),\n    );\n    let startIndex = 0;\n    let endIndex = 0;\n\n    for (const [i, entry] of Object.entries(changelog)) {\n      if (entry.version === this._loadedVersion) {\n        startIndex = i;\n      } else if (entry.version === lastLoadedVersion) {\n        break;\n      }\n\n      endIndex = i + 1;\n    }\n\n    const changeList = changelog\n      .slice(startIndex, endIndex)\n      // TODO: remove `reduce`\n      // eslint-disable-next-line unicorn/no-array-reduce\n      .reduce((array, entry) => array.concat(entry.changes), [])\n      .map((change) => escapeHtmlTag`<li>${change}</li>`);\n\n    this.container.append(\n      strToEl('<h1>Updated!</h1>'),\n      strToEl(`<ul>${changeList.join('')}</ul>`),\n    );\n\n    await domReady;\n    transitionToClass(this.container);\n  }\n}\n","import { domReady } from '../utils.js';\n\nexport default class ResultsContainer {\n  constructor(results) {\n    this._results = results;\n\n    domReady.then(() => {\n      this._container = document.querySelector('.results-container');\n      this._mobileContainer = document.querySelector(\n        '.results-container-mobile',\n      );\n      this._query = matchMedia('(min-width: 640px)');\n\n      this._query.addListener(() => this._positionResults());\n      this._positionResults();\n    });\n  }\n\n  _positionResults() {\n    if (this._query.matches) {\n      this._container.append(this._results.container);\n    } else {\n      this._mobileContainer.append(this._results.container);\n    }\n  }\n}\n","import { createNanoEvents } from 'nanoevents';\nimport { domReady } from '../utils.js';\n\n/**\n * Tabs that toggle between showing the SVG image and XML markup.\n */\nexport default class ViewToggler {\n  constructor() {\n    this.emitter = createNanoEvents();\n    /** @type {HTMLFormElement | null} */\n    this.container = null;\n\n    domReady.then(() => {\n      this.container = document.querySelector('.view-toggler');\n\n      // stop browsers remembering previous form state\n      this.container.output[0].checked = true;\n\n      this.container.addEventListener('change', () => {\n        this.emitter.emit('change', {\n          value: this.container.output.value,\n        });\n      });\n    });\n  }\n}\n","// TODO: switch to Map/Set\n\nexport default class ResultsCache {\n  constructor(size) {\n    this._size = size;\n    this.purge();\n  }\n\n  purge() {\n    this._fingerprints = [];\n    this._items = [];\n    this._index = 0;\n  }\n\n  add(fingerprint, svgFile) {\n    const oldItem = this._items[this._index];\n\n    if (oldItem) {\n      // gc blob url\n      oldItem.release();\n    }\n\n    this._fingerprints[this._index] = fingerprint;\n    this._items[this._index] = svgFile;\n\n    this._index = (this._index + 1) % this._size;\n  }\n\n  match(fingerprint) {\n    return this._items[this._fingerprints.indexOf(fingerprint)];\n  }\n}\n","import { transitionToClass } from '../utils.js';\n\nexport default class MainUi {\n  constructor(...elements) {\n    this._activated = false;\n    this._toActivate = elements;\n  }\n\n  activate() {\n    if (this._activated) return;\n    this._activated = true;\n\n    return Promise.all(\n      this._toActivate.map((element) => transitionToClass(element)),\n    );\n  }\n}\n","import { idbKeyval as storage } from '../utils/storage.js';\nimport Svgo from './svgo.js';\nimport { domReady } from './utils.js';\nimport Output from './ui/output.js';\nimport DownloadButton from './ui/download-button.js';\nimport CopyButton from './ui/copy-button.js';\nimport BgFillButton from './ui/bg-fill-button.js';\nimport Results from './ui/results.js';\nimport Settings from './ui/settings.js';\nimport MainMenu from './ui/main-menu.js';\nimport Toasts from './ui/toasts.js';\nimport FileDrop from './ui/file-drop.js';\nimport Preloader from './ui/preloader.js';\nimport Changelog from './ui/changelog.js';\nimport ResultsContainer from './ui/results-container.js';\nimport ViewToggler from './ui/view-toggler.js';\nimport ResultsCache from './results-cache.js';\nimport MainUi from './ui/main-ui.js';\n\nconst svgo = new Svgo();\n\nexport default class MainController {\n  constructor() {\n    // ui components\n    this._mainUi = null;\n    this._outputUi = new Output();\n    this._downloadButtonUi = new DownloadButton();\n    this._copyButtonUi = new CopyButton();\n    this._resultsUi = new Results();\n    this._settingsUi = new Settings();\n    this._mainMenuUi = new MainMenu();\n    this._toastsUi = new Toasts();\n\n    const bgFillUi = new BgFillButton();\n    const dropUi = new FileDrop();\n    const preloaderUi = new Preloader();\n    const changelogUi = new Changelog(self.version);\n    // _resultsContainerUi is unused\n    this._resultsContainerUi = new ResultsContainer(this._resultsUi);\n    const viewTogglerUi = new ViewToggler();\n\n    // ui events\n    this._settingsUi.emitter.on('change', () => this._onSettingsChange());\n    this._settingsUi.emitter.on('reset', (oldSettings) =>\n      this._onSettingsReset(oldSettings),\n    );\n    this._mainMenuUi.emitter.on('svgDataLoad', (event) =>\n      this._onInputChange(event),\n    );\n    dropUi.emitter.on('svgDataLoad', (event) => this._onInputChange(event));\n    this._mainMenuUi.emitter.on('error', ({ error }) =>\n      this._handleError(error),\n    );\n    viewTogglerUi.emitter.on('change', (event) =>\n      this._outputUi.set(event.value),\n    );\n    window.addEventListener('keydown', (event) => this._onGlobalKeyDown(event));\n    window.addEventListener('paste', (event) => this._onGlobalPaste(event));\n    window.addEventListener('copy', (event) => this._onGlobalCopy(event));\n\n    // state\n    this._inputItem = null;\n    this._cache = new ResultsCache(10);\n    this._latestCompressJobId = 0;\n    this._userHasInteracted = false;\n    this._reloading = false;\n\n    if ('serviceWorker' in navigator) {\n      navigator.serviceWorker\n        .register('sw.js', { scope: './' })\n        .then((registration) => {\n          registration.addEventListener('updatefound', () =>\n            this._onUpdateFound(registration),\n          );\n        });\n    }\n\n    // tell the user about the latest update\n    storage.get('last-seen-version').then((lastSeenVersion) => {\n      if (lastSeenVersion) changelogUi.showLogFrom(lastSeenVersion);\n      storage.set('last-seen-version', self.version);\n    });\n\n    domReady.then(() => {\n      const container = document.querySelector('.app-output');\n      const actionContainer = container.querySelector(\n        '.action-button-container',\n      );\n      const minorActionContainer = container.querySelector(\n        '.minor-action-container',\n      );\n      const toolbarElement = container.querySelector('.toolbar');\n      const outputElement = container.querySelector('.output');\n      const menuExtraElement = container.querySelector('.menu-extra');\n\n      // elements for intro anim\n      this._mainUi = new MainUi(\n        toolbarElement,\n        actionContainer,\n        this._outputUi.container,\n        this._settingsUi.container,\n      );\n\n      minorActionContainer.append(\n        bgFillUi.container,\n        this._copyButtonUi.container,\n      );\n      actionContainer.append(this._downloadButtonUi.container);\n      outputElement.append(this._outputUi.container);\n      container.append(this._toastsUi.container, dropUi.container);\n      menuExtraElement.append(changelogUi.container);\n\n      // load previous settings\n      this._loadSettings();\n\n      // someone managed to hit the preloader, aww\n      if (preloaderUi.activated) {\n        this._toastsUi.show('Ready now!', { duration: 3000 });\n      }\n\n      // for testing\n      // eslint-disable-next-line no-constant-condition\n      if (false) {\n        (async () => {\n          const data = await fetch('test-svgs/car-lite.svg').then((response) =>\n            response.text(),\n          );\n          this._onInputChange({ data, filename: 'car-lite.svg' });\n        })();\n      }\n    });\n  }\n\n  _onGlobalKeyDown(event) {\n    if (event.key === 'o' && (event.ctrlKey || event.metaKey)) {\n      event.preventDefault();\n      this._mainMenuUi.showFilePicker();\n    }\n\n    if (event.key === 'Escape') this._mainMenuUi.hide();\n  }\n\n  _onGlobalPaste(event) {\n    const value = event.clipboardData.getData('text');\n    if (!value.includes('</svg>')) {\n      this._toastsUi.show('Pasted value not an SVG', { duration: 2000 });\n    } else {\n      this._mainMenuUi.setPasteInput(value);\n      event.preventDefault();\n    }\n  }\n\n  _onGlobalCopy(event) {\n    const selection = window.getSelection();\n    if (!selection.isCollapsed) return;\n\n    this._toastsUi.show(\n      this._copyButtonUi.copyText() ? 'Copy successful' : 'Nothing to copy',\n      { duration: 2000 },\n    );\n\n    event.preventDefault();\n  }\n\n  _onUpdateFound(registration) {\n    const newWorker = registration.installing;\n\n    registration.installing.addEventListener('statechange', async () => {\n      if (this._reloading) return;\n\n      // the very first activation!\n      // tell the user stuff works offline\n      if (\n        newWorker.state === 'activated' &&\n        !navigator.serviceWorker.controller\n      ) {\n        this._toastsUi.show('Ready to work offline', { duration: 5000 });\n        return;\n      }\n\n      if (\n        newWorker.state === 'activated' &&\n        navigator.serviceWorker.controller\n      ) {\n        // if the user hasn't interacted yet, do a sneaky reload\n        if (!this._userHasInteracted) {\n          this._reloading = true;\n          location.reload();\n          return;\n        }\n\n        // otherwise, show the user an alert\n        const toast = this._toastsUi.show('Update available', {\n          buttons: ['reload', 'dismiss'],\n        });\n        const answer = await toast.answer;\n\n        if (answer === 'reload') {\n          this._reloading = true;\n          location.reload();\n        }\n      }\n    });\n  }\n\n  _onSettingsChange() {\n    const settings = this._settingsUi.getSettings();\n    this._saveSettings(settings);\n    this._compressSvg(settings);\n  }\n\n  async _onSettingsReset(oldSettings) {\n    const toast = this._toastsUi.show('Settings reset', {\n      buttons: ['undo', 'dismiss'],\n      duration: 5000,\n    });\n    const answer = await toast.answer;\n\n    if (answer === 'undo') {\n      this._settingsUi.setSettings(oldSettings);\n      this._onSettingsChange();\n    }\n  }\n\n  async _onInputChange({ data, filename }) {\n    const settings = this._settingsUi.getSettings();\n    this._userHasInteracted = true;\n\n    try {\n      this._inputItem = await svgo.wrapOriginal(data);\n      this._inputFilename = filename;\n    } catch (error) {\n      this._mainMenuUi.stopSpinner();\n      this._handleError(new Error(`Load failed: ${error.message}`));\n      return;\n    }\n\n    this._cache.purge();\n\n    this._compressSvg(settings);\n    this._outputUi.reset();\n    this._mainUi.activate();\n    this._mainMenuUi.allowHide = true;\n    this._mainMenuUi.hide();\n  }\n\n  _handleError(error) {\n    this._toastsUi.show(error.message, { isError: true });\n    console.error(error);\n  }\n\n  async _loadSettings() {\n    const settings = await storage.get('settings');\n    if (settings) this._settingsUi.setSettings(settings);\n  }\n\n  _saveSettings(settings) {\n    // doesn't make sense to retain the \"show original\" option\n    const { original, ...settingsToKeep } = settings;\n    storage.set('settings', settingsToKeep);\n  }\n\n  async _compressSvg(settings) {\n    const thisJobId = (this._latestCompressJobId = Math.random());\n\n    await svgo.abort();\n\n    if (thisJobId !== this._latestCompressJobId) {\n      // while we've been waiting, there's been a newer call\n      // to _compressSvg, we don't need to do anything\n      return;\n    }\n\n    if (settings.original) {\n      this._updateForFile(this._inputItem, {\n        compress: settings.gzip,\n      });\n      return;\n    }\n\n    const cacheMatch = this._cache.match(settings.fingerprint);\n\n    if (cacheMatch) {\n      this._updateForFile(cacheMatch, {\n        compareToFile: this._inputItem,\n        compress: settings.gzip,\n      });\n      return;\n    }\n\n    this._downloadButtonUi.working();\n\n    try {\n      const resultFile = await svgo.process(this._inputItem.text, settings);\n\n      this._updateForFile(resultFile, {\n        compareToFile: this._inputItem,\n        compress: settings.gzip,\n      });\n\n      this._cache.add(settings.fingerprint, resultFile);\n    } catch (error) {\n      if (error.name === 'AbortError') return;\n      error.message = `Minifying error: ${error.message}`;\n      this._handleError(error);\n    } finally {\n      this._downloadButtonUi.done();\n    }\n  }\n\n  async _updateForFile(svgFile, { compareToFile, compress }) {\n    this._outputUi.update(svgFile);\n    this._downloadButtonUi.setDownload(this._inputFilename, svgFile);\n    this._copyButtonUi.setCopyText(svgFile.text);\n\n    this._resultsUi.update({\n      comparisonSize: compareToFile && (await compareToFile.size({ compress })),\n      size: await svgFile.size({ compress }),\n    });\n  }\n}\n","import WorkerMessenger from './worker-messenger.js';\nimport SvgFile from './svg-file.js';\n\nexport default class Svgo extends WorkerMessenger {\n  constructor() {\n    super('js/svgo-worker.js');\n    this._currentJob = Promise.resolve();\n  }\n\n  async wrapOriginal(svgText) {\n    const { width, height } = await this.requestResponse({\n      action: 'wrapOriginal',\n      data: svgText,\n    });\n\n    return new SvgFile(svgText, width, height);\n  }\n\n  process(svgText, settings) {\n    this.abort();\n\n    this._currentJob = this._currentJob\n      .catch(() => {})\n      .then(async () => {\n        const { data, dimensions } = await this.requestResponse({\n          action: 'process',\n          settings,\n          data: svgText,\n        });\n\n        // return final result\n        return new SvgFile(data, dimensions.width, dimensions.height);\n      });\n\n    return this._currentJob;\n  }\n}\n","import { trackFocusMethod } from './utils.js';\nimport MainController from './main-controller.js';\n\ntrackFocusMethod();\nnew MainController(); // eslint-disable-line no-new\n"],"names":["domReady","Promise","resolve","checkState","document","readyState","addEventListener","range","createRange","strToEl","str","createContextualFragment","String","children","selectNode","documentElement","entityMap","escapeHtmlTag","strings","values","map","s","replace","reduce","val","i","readFileAsText","file","Response","text","transitionClassFunc","removeClass","element","className","transitionClass","hasClass","classList","contains","transitionEnd","listener","event","target","removeEventListener","remove","add","requestAnimationFrame","transitionTimeout","setTimeout","race","transitionToClass","transitionFromClass","idbKeyval","dbInstance","async","withStore","type","callback","db","reject","openreq","indexedDB","open","onerror","error","onupgradeneeded","result","createObjectStore","onsuccess","transaction","oncomplete","objectStore","key","request","store","get","set","value","put","delete","WorkerMessenger","constructor","url","this","_requestId","_pending","_url","_worker","release","_abortPending","terminate","requestResponse","message","id","_startWorker","postMessage","abort","Object","keys","length","_fulfillPending","DOMException","Worker","onmessage","_onMessage","data","Error","console","log","resolver","gzip","super","compress","SvgFile","width","height","_compressedSize","then","response","byteLength","URL","createObjectURL","Blob","revokeObjectURL","getXY","obj","x","pageX","y","pageY","touchDistance","touch1","touch2","dx","Math","abs","dy","hypot","getMidpoint","point1","point2","getPoints","touches","touch","PanZoom","eventArea","shouldCaptureFunc","_target","_shouldCaptureFunc","_dx","_dy","_scale","_active","_lastPoints","_onPointerDown","button","preventDefault","_onFirstPointerDown","_onPointerMove","points","averagePoint","averageLastPoint","left","top","getBoundingClientRect","scaleDiff","_update","_onPointerUp","pop","_onWheel","reset","delta","deltaY","deltaMode","max","min","style","transform","SvgOutput","container","_svgFrame","querySelector","_svgContainer","_panZoom","setSvg","nextLoad","_nextLoadPromise","src","encodeURIComponent","onload","prism","highlight","CodeOutput","_codeEl","innerHTML","Output","_types","image","code","_svgFile","_switchQueue","noAnimate","update","svgFile","_activeType","toRemove","toAdd","append","transitions","push","all","Ripple","animate","offsetLeft","FloatingActionButton","title","href","iconSvg","major","classes","setAttribute","_ripple","onClick","Spinner","_showTimeout","display","show","delay","clearTimeout","hide","DownloadButton","_spinner","setDownload","filename","download","working","done","CopyButton","_text","_pre","createElement","copyText","textContent","body","getSelection","removeAllRanges","window","addRange","execCommand","setCopyText","BgFillButton","round","num","places","mult","floor","humanSize","bytes","Results","_sizeEl","_diffEl","size","comparisonSize","createNanoEvents","events","emit","args","callbacks","on","cb","filter","MaterialSlider","rangeElement","_range","_handle","_trackOn","_val","parentNode","insertBefore","firstChild","_onInputChange","_onRangeMouseDown","_onRangeTouchStart","_onRangeTouchEnd","_setPosition","newValue","focus","blur","upListener","percent","Number","Settings","emitter","_throttleTimeout","_pluginInputs","querySelectorAll","_globalInputs","scroller","resetBtn","ranges","_resetRipple","_sliderMap","WeakMap","_onChange","_onReset","closest","oldSettings","getSettings","inputEl","checked","hasAttribute","getAttribute","setSettings","settings","name","plugins","fingerprint","output","join","MainMenu","allowHide","_loadFileInput","_pasteInput","_loadDemoBtn","_loadFileBtn","_pasteLabel","_overlay","_menu","_onMenuButtonClick","_onOverlayClick","_onLoadFileClick","_onLoadDemoClick","_onFileInputChange","_onTextInputChange","stopSpinner","showFilePicker","click","setPasteInput","dispatchEvent","Event","includes","files","fetch","Toast","duration","buttons","isError","content","_answerResolve","_hideTimeout","insertAdjacentHTML","answer","buttonElement","Toasts","toast","FileDrop","_activeEnters","_currentEnteredElement","_onDragEnter","_onDragLeave","_onDrop","dataTransfer","Preloader","activated","Changelog","loadedVersion","_loadedVersion","lastLoadedVersion","changelog","json","startIndex","endIndex","entry","entries","version","changeList","slice","array","concat","changes","change","ResultsContainer","results","_results","_container","_mobileContainer","_query","matchMedia","addListener","_positionResults","matches","ViewToggler","ResultsCache","_size","purge","_fingerprints","_items","_index","oldItem","match","indexOf","MainUi","elements","_activated","_toActivate","activate","svgo","_currentJob","svgText","action","process","catch","dimensions","focusMethod","trackFocusMethod","_mainUi","_outputUi","_downloadButtonUi","_copyButtonUi","_resultsUi","_settingsUi","_mainMenuUi","_toastsUi","bgFillUi","dropUi","preloaderUi","changelogUi","self","_resultsContainerUi","viewTogglerUi","_onSettingsChange","_onSettingsReset","_handleError","_onGlobalKeyDown","_onGlobalPaste","_onGlobalCopy","_inputItem","_cache","_latestCompressJobId","_userHasInteracted","_reloading","navigator","serviceWorker","register","scope","registration","_onUpdateFound","storage","lastSeenVersion","showLogFrom","actionContainer","minorActionContainer","toolbarElement","outputElement","menuExtraElement","_loadSettings","ctrlKey","metaKey","clipboardData","getData","isCollapsed","newWorker","installing","state","controller","location","reload","_saveSettings","_compressSvg","wrapOriginal","_inputFilename","original","settingsToKeep","thisJobId","random","_updateForFile","cacheMatch","compareToFile","resultFile"],"mappings":"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"}